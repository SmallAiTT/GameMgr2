var path = require("path");
var fs = require("fs");

function readSql(baseDir, pre, files, result){
    result = result || {};
    for (var i = 0, li = files.length; i < li; i++) {
        var file = path.join(pre, files[i]);
        if(fs.statSync(file).isDirectory()){
            readSql(baseDir, file, fs.readdirSync(file), result);
        }else{
            var extName = path.extname(file);
            if(extName.toLowerCase() == ".sql"){
                result[path.basename(file, extName)] = path.relative(baseDir, file).replace(/\\/g, "/");
            }
        }
    }
    return result;
}

function test(){
    fs.readdir(__dirname, function(err, files){
        for (var i = 0, li = files.length; i < li; i++) {
            var dirPath = path.join(__dirname, files[i], "sql");
            if(fs.existsSync(dirPath)){
                var content = "module.exports = {";
                var result = readSql(dirPath, dirPath, fs.readdirSync(dirPath));
                for (var key in result) {
                    content += "\r\n    " + key + ' : "' + result[key] + '",';
                }
                content = content.substring(0, content.length - 1);
                content += "\r\n};"
                var sqlCodeFile = path.join(dirPath, "index.js");
                fs.writeFileSync(sqlCodeFile, content);
                console.log("gen--->" + sqlCodeFile);
            }
        }
    });
};

test();
