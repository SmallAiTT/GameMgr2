var ttUtils = require("tt-utils").ttUtils;
var PvlPo = require("../po/PvlPo");
var ctrlConst = require("../cfg/ctrlConst");
var ctrlUrl = ctrlConst.pvl;
var gmClient = require("tt-db").gmClient;


module.exports = function(app){
    app.post(ctrlUrl.create, function(req, res){
        ttUtils.createPoByCtrl(req, res, gmClient, PvlPo);
    });
    app.post(ctrlUrl.update, function(req, res){
        var po = ttUtils.transReq(req, PvlPo);
        gmClient.update(PvlPo, po, {id : po.id}, function(err, result){
            err ? ttUtils.doErr(res, err) : ttUtils.doInfo(res, null, result);
        });
    });
    app.post(ctrlUrl.read, function(req, res){
        gmClient.read(PvlPo, {id : req.body.id}, function(err, result){
            err ? ttUtils.doErr(res, err) : ttUtils.doInfo(res, null, result);
        });
    });
    app.post(ctrlUrl.del, function(req, res){
        gmClient.del(PvlPo, {id : req.body.id}, function(err, result){
            err ? ttUtils.doErr(res, err) : ttUtils.doInfo(res, null, result);
        });
    });
    app.post(ctrlUrl.list, function(req, res){
        gmClient.list(PvlPo, function(err, result){
            err ?  ttUtils.doErr(res, err) : ttUtils.doInfo(res, null, {rows : result, total : result.length});
        });
    });

};
