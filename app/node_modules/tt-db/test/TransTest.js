var ttCfg = require("tt-cfg");
var pool = require('../src/dbPool').create(ttCfg.db.gmClient);
var Trans = require("../src/Trans");

var trans = new Trans(pool);

function myDao1(ts, a, b, cb){
    console.log("myDao1->" + a + "  " + b);
    ts.query("update dm_curd set name = ? where id = ?", ["N1", 1], function(err, results){
        err ? cb(err) : cb(null, ts, a, b);
    });
}
function myDao2(ts, a, b, cb){
    console.log("myDao2->" + a + "  " + b);
    ts.query("update dm_curd set name = ? where id = ?", ["N2", 2], function(err, results){
        err ? cb(err) : cb(null, ts, a, b);
    });
}

function myBiz(ts, a, b, cb){
    console.log("myBiz");
    myDao1(ts, a, b, function(err, ts, a1, b1){
        if(err) return cb(err);
        myDao2(ts, a1, b1, cb);
    });
};

function callBiz(a, b, cb){
    trans.exec(myBiz, arguments);
};

callBiz("a", "b", function(err, t1, a, b){
    console.log("CB");
    console.log(a, b);
});

