var ttDb = require("../index");
var async = require("async");


var trans = ttDb.gmTrans;

function myDao1(ts, a, b, cb){
    console.log("myDao1->" + a + "  " + b);
    ts.query("update dm_curd set name = ? where id = ?", ["N1", 1], function(err, results){
        err ? cb(err) : cb(null, ts, a, b);
    });
}
function myDao2(ts, a, b, cb){
    console.log("myDao2->" + a + "  " + b);
    ts.update("dm_curd1", {name : "N2"}, {id : 2}, function(err, results){
        err ? cb(err) : cb(null, ts, a, b);
    });
}

function myBiz(ts, a, b, cb){
    console.log("myBiz");
    async.series([
        function(cb){
            myDao1(ts, a, b, cb);
        },
        function(cb){
            myDao2(ts, a, b, cb);
        }
    ], function(err, results){
        cb(err);
    });
};

function callBiz(a, b, cb){
    trans.exec(myBiz, arguments);
};
/*
for(var i = 0; i < 100; ++i){
    callBiz("a", i, function(err, t1, a, b){
        console.log("CB");
        console.log(a, b);
    });
}
*/

callBiz("a", 1, function(err){
    console.log("CB");
});

