function Trans(pool){
    var _pool = pool

    this.exec = function(func, args, target){
        var arr = Array.apply(null, args);
        var cb = arr.pop();
        _pool.acquire(function(err, client){
            if(err) return cb(err);
            var ts = client.startTransaction();
            arr.splice(0, 0, ts);

            function tempCb(err){
                if(err) {
                    ts.rollback();
                    _pool.release(client);
                    return cb(err);
                }
                ts.commit();
                _pool.release(client);
                cb.apply(null, arguments);
            }
            arr.push(tempCb);
            func.apply(target || null, arr);
            ts.execute();
        });
    };
    this.release = function(client){
        _pool.release(client);
    };
}

module.exports = Trans;